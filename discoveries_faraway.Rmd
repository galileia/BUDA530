---
title: "R Notebook"
output: html_notebook
---



```{r}
library(faraway)

install.packages("tscount")
library(tscount)
data("discoveries")
```


Problem 1:  The discoveries dataset in the faraway package lists the numbers of "great" inventions and scientific discoveries in each year from 1860-1959.  Investigate the number of discoveries over time.  Use the appropriate Poisson model to fit the number of discoveries against the year.  Hint you may need to create this.  Comment on any findings of the model you have.
```{r}
summary(discoveries)
plot(discoveries, main = "Number of Discoveries")
```

```{r}
ts(discoveries)

```
Frequency = 1 => yearly data 


A plot of number of discoveries vs time shows some increase from 1860 to early 1900's with a peak in number of discoveries in the early 1980's. The average number of discoveries remains around the mean of 3.1 per year until about 1930 when we see a steady decline until 1960. 
```{r}
mean(discoveries)
plot(discoveries, main = "Number of Discoveries")
abline(mean(discoveries), 0, col = "red")

```
We first fit a linear regression model to see what we get:
```{r}
model0 <- lm(discoveries ~ ., data = discoveries)
summary(model0)

```
The "essentially perfect fit" is suspicious. Looking at the residual plots there's a clear outlier in the data:


```{r}
par(mfrow = c(2, 2))
plot(model0)
```
Attempr to refit, removing the outlier:
```{r}
dim(discoveries)
disc_out <- di
```






```{r}
model1 <- glm(discoveries ~ x, family = poisson, data = discoveries)
summary(model1)
```
The model is $log(Î¼i hat) = 0.25696 + 0.22869 xi$

The coefficient for x is significant given its small p-value; since it is > 0, the greater the time, the larger the number of expected discoveries, or for one unit increase of time (1 year), the number of discoveries will increase and get multiplied by 1.26

```{r}
(exp_coeff <- exp(0.22869))
```

Is the model a good fit?
```{r}
1 - pchisq(deviance(model1), df.residual(model1))
```
The p-value is large indicating no evidence of a lack of fit. We can compare the current model with a null model and we observe the same conclusion. 
```{r}
anova(model1, test = "Chi")
```

Model diagnostics 
```{r}
par(mfrow = c(2, 2))
plot(model1)
```
Seem to have an outlier point 26. We also see non-constant variance in the residuals  The lack of fit maybe due to dispersion. Check the relationship between the mean and variance:

```{r}
model1_mean <- log(fitted(model1))
model1_var <- log((discoveries-fitted(model1))^2)

plot(model1_mean, model1_var)
abline(0,1)
```
We see some dispersion of the data. How well is the model predicting?
```{r}
pred <- predict(model1, type = "response")
plot(pred, discoveries)

```

Run a negative binomial model: 
```{r}
model2 <- glm.nb(discoveries ~ x, data = discoveries)
summary(model2)
```
We got an error message and theta is really large. Try using the quasipoisson:

```{r}
model_disp <- glm(discoveries ~ x, family = quasipoisson(link = log), data = discoveries)
summary.glm(model_disp)

```
Residuals 
```{r}
par(mfrow = c(1, 3))
plot(residuals(model2) ~ predict(model2, type = "response"))
plot(residuals(model2) ~ predict(model2, type = "link"))
plot(residuals(model2, type = "response") ~ predict(model2, type = "response"))
```














